<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="Peng." />
    
    <title>简析Javascript的prototype和__proto__</title>
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1">
    <link href="/atom.xml" rel="alternate" title="Peng's Blog" type="application/atom+xml" />
    <link rel="stylesheet" href="/media/css/style.css">
    <link rel="stylesheet" href="/media/css/github.css">
    <link rel="stylesheet" href="/media/css/fontawesome.css">
    <script src="/media/js/jquery-1.7.1.min.js" type="text/javascript" charset="utf-8"></script> 
    <script type="text/javascript" src="/media/js/highlight.pack.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
    </script>
  </head>
  <body>
      <div id="main" role="main">
        <header>
          <div id="header">
            <h1><a title="Peng's Blog" class="" href="/">Peng's Blog</a></h1>
          </div>
          <nav>
            
            <span><a title="Archive" href="/archive.html"><i class="fa fa-list-ul"></i></a></span>
            
            <span><a title="Tags" href="/tags.html"><i class="fa fa-tags"></i></a></span>
            
            <span><a title="About" href="/about.html"><i class="fa fa-user"></i></a></span>
            
          </nav>
        </header>
        <div id="content">
        <article>
  <section class="title">
    <h2>简析Javascript的prototype和__proto__ </h2>
  </section>
  <section class="meta">
  <span class="time">
    <time datetime="2014-07-12">2014-07-12</time>
  </span>
  
  <span class="tags">
    
    <a href="/tags.html#js" title="js">#js</a>
    
    <a href="/tags.html#javascript" title="javascript">#javascript</a>
    
  </span>
  
  </section>
  <section class="post">
  <p>首先，需要知道以下事实：</p>

<ul>
<li>Javascript的继承是基于原型链模式的。</li>
<li>Javascript的原型是一个对象。</li>
<li>Javascript的继承本质是一（或多）个对象引用了另一个对象的属性和方法。</li>
</ul>


<p><strong>直接结论：</strong></p>

<p><strong>__proto__ 是对象的一个内部隐藏属性，它的值是该对象的原型。</strong></p>

<p><strong>prototype 是函数对象的一个属性，它的值是一个对象（默认为 {} ），当该函数用作构造函数时，新创建对象的原型（__proto__）将指向该属性值。</strong></p>

<p>好，show you the code:</p>

<pre><code>&gt; var A = function(x){this.name = x;};   //定义函数 A
&gt; var a = new A('ima');     // 通过函数A创建对象a
&gt; a
{ name: 'ima' }

&gt; A.prototype       //因为A.prototype默认是 {}
{}
&gt; a.__proto__       //所以对象a的原型（__proto__）就是 {}
{}
&gt; A.prototype === a.__proto__   //它们都是指向同一个 {}
true
&gt; {} === {}             //js中不同的空对象引用不一样，请对比上者感受一下
false
</code></pre>

<p>再展示另一个例子：</p>

<pre><code>&gt; var D = function(y){this.desc = y;};   //定义函数D

&gt; D.prototype = a;           //将D的prototype指向对象a
{ name: 'ima' }

&gt; var d = new D('imd')      //通过函数D创建对象d
&gt; d
{ desc: 'imd' }

&gt; d.__proto__               //对象d的原型就是对象a
{ name: 'ima' }
&gt; d.__proto__ === a
true

&gt; d.name                    //d"继承"了对象a的属性，实质是引用
'ima'
&gt; a.name = 'iama!'          //更改a.name, d.name也发生了改变
&gt; d.name                    //具体可以查看Javascript原型链原理
'iama!'

/* 需要注意的是：非函数对象是没有prototype属性的：*/
&gt; a.prototype
undefined
&gt; d.prototype
undefined

/* 而函数是有__proto__的，因为函数也是对象：*/
&gt; A.__proto__      
[Function: Empty]       //函数的默认原型是空函数，正如对象的默认原型是空对象
&gt; A.__proto__.toString()   
'function Empty() {}'
</code></pre>

<p>再次总结：</p>

<ol>
<li>__protot__指向对象的原型。</li>
<li>prototype是函数的属性，作为使用new创建的函数实例的原型。</li>
</ol>


<p>建议阅读阮一峰的<a href="http://www.ruanyifeng.com/blog/2011/06/designing_ideas_of_inheritance_mechanism_in_javascript.html">Javascript继承机制的设计思想</a>，简单通俗地了解为什么Javascript采用prototype这种方式实现继承。</p>

<hr />

<p>题外话：（关于constructor）</p>

<pre><code>/* 对象a的构造函数是函数A */
&gt; a.constructor.toString()
'function (x){this.name = x;}'
&gt; a.constructor === A
true

/* 因为A是一个函数对象，所以A的构造函数就是function的构造函数Function */
&gt; A.constructor
[Function: Function]
&gt; A.constructor.toString()
'function Function() { [native code] }'
&gt; A.constructor === Function.constructor
true
/* 函数A的原型(__protot__)就是它的构造函数（Function）的prototype */
&gt; A.constructor === Function
true
&gt; Function.prototype
[Function: Empty]
&gt; A.__proto__ === Function.prototype
true

/* 但是 ！！！ */
/* 继承了对象a的d，它的构造函数不是D，而是A */
&gt; d.constructor.toString()
'function (x){this.name = x;}'

&gt; d.constructor === a.constructor
true

&gt; d.constructor === A
true
</code></pre>

<p>以上代码在Node.js v0.10.30环境下测试。</p>

  </section>
  
</article>

        </div>
        <footer>
          <div>
            
            &copy; 2014 ~ 2014 Peng. | powered by jekyll | themed by <a href="http://lhzhang.com" title="sext vi" target="_blank">sext vi</a> | fork <a href="https://github.com/waynezhang/blog" title="fork me" target="_blank">me</a>
          </div>
        </footer>
      </div> <!-- main -->
  </body>
</html>
